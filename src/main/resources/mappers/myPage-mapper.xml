<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="myPageMapper">
	<!-- resultMap Address-->
	<resultMap id="addressResultSet" type="Address">
		<id property="aNo" column="A_NO"/>
		<result property="aMno" column="A_M_NO"/>
		<result property="aPlace" column="PLACE"/>
		<result property="aName" column="NAME"/>
		<result property="aAddress" column="ADDRESS"/>
		<result property="aPhone" column="PHONE"/>
		<result property="aRecentDate" column="RECENTDATE"/>
	</resultMap>
	<!-- resultMap Member-->
	<resultMap id="memberResultSet" type="Member">
		<id property="mNo" column="M_NO"/>
		<result property="mId" column="M_ID"/>
		<result property="pwd" column="PWD"/>
		<result property="mName" column="NAME"/>
		<result property="phone" column="PHONE"/>
		<result property="mSort" column="M_SORT"/>
		<result property="mStatus" column="M_STATUS"/>
		<result property="pushEnabled" column="PUSH_ENABLED"/>
		<result property="enrollDate" column="ENROLLDATE"/>
	</resultMap>
	<!-- resultMap Driver-->
	<resultMap id="driverResultSet" type="Driver">
		<id property="dNo" column="D_NO"/>
		<result property="dmNo" column="D_M_NO"/>
		<result property="capacity" column="CAPACITY"/>
		<result property="type" column="TYPE"/>
		<result property="carNo" column="CAR_NO"/>
		<result property="idImgOrigin" column="ID_IMG_ORIGIN"/>
		<result property="idImgRename" column="ID_IMG_RENAME"/>
		<result property="carImgOrigin" column="CAR_IMG_ORIGIN"/>
		<result property="carImgRename" column="CAR_IMG_RENAME"/>
	</resultMap>
	
	<!-- 폰번호 업데이트 -->
	<update id="updatePhone" parameterType="Member">
		UPDATE MEMBER
		SET PHONE = #{phone}
		WHERE M_NO = #{mNo}
	</update>
	<!-- 비밀번호 업데이트 -->
	
	<!-- 프로필사진 업데이트 -->
	
	<update id="updateProfileImg" parameterType="Driver">
		UPDATE DRIVER
		SET ID_IMG_ORIGIN = #{idImgOrigin},
			ID_IMG_RENAME = #{idImgRename}
		WHERE D_M_NO = #{dmNo}
	</update>
	<!-- 주소록갯수 -->
	<select id="getAddrListCount" resultType="_int">
		SELECT COUNT(*)
		FROM ADDRESS
		WHERE A_M_NO=#{mNo}
	</select>
	<!-- 주소록 리스트 -->
	<select id="selectAddrList" resultMap="addressResultSet">
		SELECT *
		FROM ADDRESS
		WHERE A_M_NO=#{mNo}
		ORDER BY RECENTDATE DESC
	</select>
	<!-- 수정 주소록 상세 불러오기 -->	
	<select id="getUpAddr" resultMap="addressResultSet">
		SELECT *
		FROM ADDRESS
		WHERE A_NO=#{aNo}
	</select>
	
	<!--  주소록 수정 -->
	<update id="updateAddr" parameterType="Address">
		UPDATE ADDRESS SET 
		<choose>
			<when test="aPlace != null and aPlace !=''">
				PLACE=#{aPlace},
			</when>
			<otherwise>
				PLACE=NULL,	
			</otherwise>		 
		</choose>
		NAME=#{aName},
		ADDRESS=#{aAddress},
		PHONE=#{aPhone},
		RECENTDATE=SYSDATE
		WHERE A_NO=#{aNo}
	</update>
	<!-- 주소록 추가  -->
	<insert id="insertAddr" parameterType="Address">
		INSERT INTO ADDRESS VALUES
		<choose>
			<when test="aPlace != null and aPlace !=''">
				('A' || SEQ_ANO.NEXTVAL,#{aMno},#{aPlace},#{aName},#{aAddress},#{aPhone},SYSDATE)	
			</when>
			<otherwise>
				('A' || SEQ_ANO.NEXTVAL,#{aMno},NULL,#{aName},#{aAddress},#{aPhone},SYSDATE)	
			</otherwise>
		</choose>
	</insert>
	<!--  주소록 삭제 -->
	<delete id="deleteAddr" parameterType="_int">
		DELETE FROM ADDRESS
		WHERE A_NO={aNo}
	</delete>
	
	<!-- 트럭정보  -->
	<select id="truckInfoView" resultMap="driverResultSet">
	SELECT *
	FROM DRIVER
	WHERE D_M_NO=#{mNo}
	</select>
	
	
</mapper>