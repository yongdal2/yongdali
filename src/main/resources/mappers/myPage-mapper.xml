<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="myPageMapper">
	<!-- resultMap -->
	<resultMap id="addressResultSet" type="Address">
		<id property="aNo" column="A_NO"/>
		<result property="aMno" column="A_M_NO"/>
		<result property="aPlace" column="PLACE"/>
		<result property="aName" column="NAME"/>
		<result property="aAddress" column="ADDRESS"/>
		<result property="aPhone" column="PHONE"/>
		<result property="aRecentDate" column="RECENTDATE"/>
	</resultMap>
	
	<!-- 주소록갯수 -->
	<select id="getAddrListCount" resultType="_int">
		SELECT COUNT(*)
		FROM ADDRESS
		WHERE A_M_NO=#{mNo}
	</select>
	<!-- 주소록 리스트 -->
	<select id="selectAddrList" resultMap="addressResultSet">
		SELECT *
		FROM ADDRESS
		WHERE A_M_NO=#{mNo}
		ORDER BY RECENTDATE DESC
	</select>
	<!-- 수정 주소록 상세 불러오기 -->	
	<select id="getUpAddr" resultMap="addressResultSet">
		SELECT *
		FROM ADDRESS
		WHERE A_NO=#{aNo}
	</select>
	
	<!--  주소록 수정 -->
	<update id="updateAddr" parameterType="Address">
		UPDATE ADDRESS SET 
		<choose>
			<when test="aPlace != null and aPlace !=''">
				PLACE=#{aPlace},
			</when>
			<otherwise>
				PLACE=NULL,	
			</otherwise>		 
		</choose>
		NAME=#{aName},
		ADDRESS=#{aAddress},
		PHONE=#{aPhone},
		RECENTDATE=SYSDATE
		WHERE A_NO=#{aNo}
	</update>
	<!-- 주소록 추가  -->
	<insert id="insertAddr" parameterType="Address">
		INSERT INTO ADDRESS VALUES
		<choose>
			<when test="aPlace != null and aPlace !=''">
				('A' || SEQ_ANO.NEXTVAL,#{aMno},#{aPlace},#{aName},#{aAddress},#{aPhone},SYSDATE)	
			</when>
			<otherwise>
				('A' || SEQ_ANO.NEXTVAL,#{aMno},NULL,#{aName},#{aAddress},#{aPhone},SYSDATE)	
			</otherwise>
		</choose>
	</insert>
	<!--  주소록 삭제 -->
	<delete id="deleteAddr" parameterType="_int">
		DELETE FROM ADDRESS
		WHERE A_NO={aNo}
	</delete>
</mapper>